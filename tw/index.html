<!DOCTYPE html>
<html lang="zh-TW">
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta charset="UTF-8">
		<meta name="description" content="百年藏曆線上查詢工具，提供1951年-2051年公曆藏曆對照查詢，包含藏曆節日、日月食資訊、佛教節日等詳細資訊。支援簡體中文和繁體中文，響應式設計適配手機平板電腦。">
		<meta name="keywords" content="藏曆,百年藏曆,藏曆查詢,公曆藏曆對照,藏曆節日,佛教節日,日月食,萬年曆,線上日曆,藏曆月曆,西藏曆法,藏族傳統節日">
		<meta name="author" content="Stone Huang">
		<meta name="robots" content="index, follow">
		<meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
		<meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
		
		<!-- Open Graph 標籤 -->
		<meta property="og:title" content="百年藏曆 - 線上藏曆查詢工具">
		<meta property="og:description" content="提供1951年-2051年公曆藏曆對照查詢，包含藏曆節日、日月食資訊等詳細資訊。">
		<meta property="og:type" content="website">
		<meta property="og:url" content="https://stonelf.github.io/zangli/tw/">
		<meta property="og:image" content="https://stonelf.github.io/zangli/favicon.ico">
		<meta property="og:site_name" content="百年藏曆">
		<meta property="og:locale" content="zh_TW">
		<meta property="og:locale:alternate" content="zh_CN">
		
		<!-- Twitter Card 標籤 -->
		<meta name="twitter:card" content="summary_large_image">
		<meta name="twitter:title" content="百年藏曆 - 線上藏曆查詢工具">
		<meta name="twitter:description" content="提供1951年-2051年公曆藏曆對照查詢，包含藏曆節日、日月食資訊等詳細資訊。">
		<meta name="twitter:image" content="https://stonelf.github.io/zangli/favicon.ico">
		
		<!-- 網站圖標 -->
		<link rel="icon" href="../favicon.ico" type="image/x-icon">
		<link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
		
		<title>百年藏曆 - 線上藏曆查詢工具 | 公曆藏曆對照 | 藏曆節日查詢</title>
		
		<!-- 多語言支援 -->
		<link rel="alternate" hreflang="zh-CN" href="https://stonelf.github.io/zangli/" />
		<link rel="alternate" hreflang="zh-TW" href="https://stonelf.github.io/zangli/tw/" />
		<link rel="alternate" hreflang="x-default" href="https://stonelf.github.io/zangli/" />
		
		<!-- 結構化資料 -->
		<script type="application/ld+json">
		{
			"@context": "https://schema.org",
			"@type": "WebApplication",
			"name": "百年藏曆",
			"url": "https://stonelf.github.io/zangli/tw/",
			"description": "提供1951年-2051年公曆藏曆對照查詢，包含藏曆節日、日月食資訊等詳細資訊",
			"applicationCategory": "Calendar",
			"operatingSystem": "All",
			"offers": {
				"@type": "Offer",
				"price": "0",
				"priceCurrency": "CNY"
			},
			"author": {
				"@type": "Person",
				"name": "Stone Huang"
			},
			"datePublished": "2024-01-01",
			"inLanguage": ["zh-TW", "zh-CN"],
			"keywords": "藏曆,百年藏曆,藏曆查詢,公曆藏曆對照,藏曆節日,佛教節日,日月食,萬年曆"
		}
		</script>
		
		<script src="../js/langDetect.js"></script>
		<style>
			:root {
				--primary-color: #8B4513;
				--secondary-color: #CD853F;
				--accent-color: #FF6B35;
				--text-color: #2C1810;
				--bg-color: #FFF8F0;
				--card-bg: #FFFFFF;
				--border-color: #E5D5C8;
				--today-bg: #FFE4B5;
				--today-border: #FF8C00;
				--lunar-eclipse: #E6E6FF;
				--solar-eclipse: #FFE6E6;
				--shadow: 0 2px 10px rgba(139, 69, 19, 0.1);
				--shadow-hover: 0 4px 20px rgba(139, 69, 19, 0.15);
			}

			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family: 'Segoe UI', 'Microsoft YaHei', '微软雅黑', Tahoma, Geneva, Verdana, sans-serif;
				background: linear-gradient(135deg, var(--bg-color) 0%, #F5E6D3 100%);
				color: var(--text-color);
				line-height: 1.6;
				min-height: 100vh;
			}

			.container {
				max-width: 1200px;
				margin: 0 auto;
				padding: 20px;
			}

                        .header {
                                text-align: center;
                                margin-bottom: 20px;
                                padding: 10px 20px;
                                background: var(--card-bg);
                                border-radius: 15px;
                                box-shadow: var(--shadow);
                                position: relative;
                        }

                        .lang-switch {
                                position: absolute;
                                top: 10px;
                                right: 20px;
                                font-size: 0.9rem;
                        }

			.header h1 {
				font-size: 2.5rem;
				color: var(--primary-color);
				margin-bottom: 10px;
				font-weight: 700;
			}

			.header .subtitle {
				font-size: 1.1rem;
				color: var(--secondary-color);
				margin-bottom: 0px;
			}

			.selected-day {
				background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
				color: white;
				padding: 15px 25px;
				border-radius: 15px;
				font-size: 1.2rem;
				font-weight: 600;
				box-shadow: var(--shadow);
				margin-bottom: 10px;
				text-align: center;
				line-height: 1.3;
				max-width: 90%;
				height: 85px;
				display: flex;
				flex-direction: column;
				justify-content: center;
				align-items: center;
				margin-left: auto;
				margin-right: auto;
				overflow: hidden;
			}

			.selected-day .festival-info {
				font-size: 0.9rem;
				margin-top: 3px;
				margin-bottom: 0;
				opacity: 0.95;
				font-weight: 500;
				line-height: 1.2;
			}

			.selected-day-bottom {
				background: var(--card-bg);
				border: 2px solid var(--primary-color);
				border-radius: 15px;
				padding: 20px;
				margin: 30px 0;
				text-align: center;
				box-shadow: var(--shadow);
				font-size: 1.1rem;
				color: var(--text-color);
				line-height: 1.3;
				height: 100px;
				display: flex;
				flex-direction: column;
				justify-content: center;
				align-items: center;
				overflow: hidden;
			}

			.selected-day-bottom .festival-info {
				color: var(--accent-color);
				font-weight: 600;
				margin-top: 5px;
				margin-bottom: 0;
				font-size: 0.95rem;
				line-height: 1.2;
			}

			.controls {
				display: flex;
				flex-direction: row !important;
				justify-content: center;
				align-items: center;
				gap: 12px;
				margin-bottom: 20px;
				padding: 0 10px;
			}

			.controls label {
				font-weight: 600;
				color: var(--primary-color);
				font-size: 1.1rem;
			}

			.controls select {
				padding: 12px 20px;
				border: 2px solid var(--border-color);
				border-radius: 8px;
				font-size: 1.1rem;
				background: var(--card-bg);
				color: var(--text-color);
				cursor: pointer;
				transition: all 0.3s ease;
				min-width: 100px;
			}

			.controls select:hover {
				border-color: var(--secondary-color);
				box-shadow: 0 2px 8px rgba(139, 69, 19, 0.1);
			}

			.controls select:focus {
				outline: none;
				border-color: var(--primary-color);
				box-shadow: 0 0 0 3px rgba(139, 69, 19, 0.1);
			}

			.controls > .nav-btn, .controls > .nav-btn.today-btn {
				flex: 1 1 0;
				min-width: 0;
				padding-left: 0;
				padding-right: 0;
			}

			.nav-btn, .nav-btn.today-btn {
				min-width: 64px;
				height: 42px;
				padding: 0 18px;
				border-radius: 16px;
				font-size: 1rem;
				font-weight: 600;
				border: none;
				box-shadow: 0 2px 8px rgba(139,69,19,0.08);
				transition: all 0.18s cubic-bezier(.4,2,.6,1);
				display: flex;
				align-items: center;
				justify-content: center;
				background: var(--card-bg);
				color: var(--text-color);
				cursor: pointer;
			}

			.nav-btn.today-btn {
				background: linear-gradient(45deg, var(--accent-color), #FF8C42);
				color: #fff;
				box-shadow: 0 4px 16px rgba(255,107,53,0.12);
			}

			.nav-btn:hover, .nav-btn:focus {
				transform: translateY(-2px) scale(1.04);
				box-shadow: 0 6px 20px rgba(139,69,19,0.18);
				z-index: 1;
			}

			.nav-btn:active {
				transform: scale(0.98);
			}

			.nav-btn.prev-year,
			.nav-btn.next-year {
				background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
				color: white;
				border-color: var(--primary-color);
				flex: 1;
			}

			.nav-btn.prev-month,
			.nav-btn.next-month {
				background: linear-gradient(45deg, var(--secondary-color), #DEB887);
				color: var(--text-color);
				border-color: var(--secondary-color);
				flex: 1;
			}

			/* 移动端响应式设计 */
			@media (max-width: 768px) {
				.controls {
					gap: 6px;
					padding: 0 4px;
				}
				.nav-btn, .nav-btn.today-btn {
					min-width: 48px;
					height: 36px;
					font-size: 0.95rem;
					border-radius: 12px;
					padding: 0 8px;
				}
			}

			@media (max-width: 480px) {
				.controls {
					gap: 3px;
					padding: 0 3px;
				}
				
				.nav-btn, .nav-btn.today-btn {
					height: 32px;
					line-height: 32px;
				}
				
				.nav-btn {
					padding: 8px 3px;
					font-size: 0.75rem;
					min-width: 0;
					flex: 1;
				}
				
				.nav-btn span {
					display: none;
				}
				
				.nav-btn.prev-year::after {
					content: "◀年";
				}
				
				.nav-btn.next-year::after {
					content: "年▶";
				}
				
				.nav-btn.prev-month::after {
					content: "◀月";
				}
				
				.nav-btn.next-month::after {
					content: "月▶";
				}
				
				.nav-btn.today-btn {
					font-size: 0;
					flex: 1;
				}
				
				.nav-btn.today-btn::after {
					content: "今天";
					font-size: 0.75rem;
				}
			}

			@media (max-width: 360px) {
				.controls {
					gap: 2px;
					padding: 0 2px;
				}
				
				.nav-btn {
					padding: 6px 2px;
					font-size: 0.7rem;
					min-width: 0;
					flex: 1;
				}
			}

			.calendar-container {
				background: var(--card-bg);
				border-radius: 15px;
				box-shadow: var(--shadow);
				overflow: hidden;
				margin-bottom: 30px;
			}

			.calendar-table {
				width: 100%;
				border-collapse: collapse;
			}

			.calendar-table th {
				background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
				color: white;
				padding: 15px 8px;
				font-weight: 600;
				font-size: 1rem;
				text-align: center;
				border: none;
				white-space: nowrap;
			}

			.calendar-table td {
				border: 1px solid var(--border-color);
				padding: 8px;
				vertical-align: top;
				height: 100px;
				width: 14.28%;
				position: relative;
				cursor: pointer;
				transition: background-color 0.15s ease, box-shadow 0.15s ease, transform 0.1s ease;
				background: var(--card-bg);
			}

			.calendar-table td:active {
				transform: scale(0.98);
				transition: transform 0.05s ease;
			}

			.calendar-table td:not(:active) {
				transition: transform 0.1s ease;
			}

			.calendar-table td:hover {
				background: #F8F8F8;
				box-shadow: inset 0 0 10px rgba(139, 69, 19, 0.1);
			}

			.calendar-table td.today {
				background: var(--today-bg);
				border: 2px solid var(--today-border);
				box-shadow: 0 0 15px rgba(255, 140, 0, 0.3);
			}

			.calendar-table td.today::before {
				content: "今天";
				position: absolute;
				top: 2px;
				right: 2px;
				background: var(--accent-color);
				color: white;
				font-size: 0.7rem;
				padding: 2px 6px;
				border-radius: 10px;
				font-weight: 600;
			}

			.calendar-table td.selected {
				background: #E8F4FD !important;
				border: 2px solid #4A90E2 !important;
				box-shadow: 0 0 10px rgba(74, 144, 226, 0.3) !important;
				transition: none !important;
			}

			.calendar-table td.selected.today {
				background: linear-gradient(135deg, var(--today-bg) 0%, #E8F4FD 100%) !important;
				border: 2px solid var(--today-border) !important;
				box-shadow: 0 0 15px rgba(255, 140, 0, 0.4) !important;
				transition: none !important;
			}

			.day-number {
				font-size: 1.2rem;
				font-weight: 600;
				color: var(--text-color);
				margin-bottom: 4px;
			}

			.day-number.first-day {
				text-align: center;
			}

			.lunar-date {
				font-size: 1rem;
				color: var(--primary-color);
				font-weight: 600;
				margin-bottom: 2px;
				text-align: center;
			}

			.lunar-date.festival {
				position: relative;
			}

			.lunar-date.festival::before {
				content: "🎉";
				position: absolute;
				top: -2px;
				right: -2px;
				font-size: 0.6rem;
				opacity: 0.8;
				animation: festivalPulse 2s infinite;
			}

			@keyframes festivalPulse {
				0%, 100% { transform: scale(1); opacity: 0.8; }
				50% { transform: scale(1.2); opacity: 1; }
			}

			.lunar-month {
				color: var(--accent-color);
				font-weight: 700;
			}

			.extra-info {
				font-size: 0.8rem;
				color: var(--secondary-color);
				text-align: center;
				line-height: 1.2;
			}

			.eclipse-info {
				font-size: 0.75rem;
				color: #666;
				text-align: center;
				margin-top: 2px;
			}

			.lunareclipse {
				background: var(--lunar-eclipse) !important;
			}

			.solareclipse {
				background: var(--solar-eclipse) !important;
			}

			.info-section {
				background: var(--card-bg);
				border-radius: 15px;
				padding: 25px;
				box-shadow: var(--shadow);
				margin-bottom: 20px;
			}

			.info-section h3 {
				color: var(--primary-color);
				margin-bottom: 15px;
				font-size: 1.3rem;
			}

			.info-section p {
				margin-bottom: 10px;
				color: var(--text-color);
			}

			.mobile-tip {
				background: linear-gradient(45deg, var(--accent-color), #FF8C42);
				color: white;
				padding: 15px;
				border-radius: 10px;
				text-align: center;
				font-weight: 600;
				margin-bottom: 20px;
			}

			.navigation-hint {
				text-align: center;
				color: var(--secondary-color);
				font-size: 0.9rem;
				margin-bottom: 20px;
				padding: 10px;
				background: rgba(139, 69, 19, 0.05);
				border-radius: 8px;
			}

			.festival-tooltip {
				position: fixed;
				background: var(--card-bg);
				border: 2px solid var(--accent-color);
				border-radius: 10px;
				padding: 15px;
				box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
				z-index: 1000;
				max-width: 280px;
				font-size: 0.9rem;
				color: var(--text-color);
				display: none;
				animation: tooltipFadeIn 0.3s ease-out;
			}

			.festival-tooltip::before {
				content: "🎉";
				font-size: 1.2rem;
				margin-right: 8px;
			}

			.festival-tooltip .close-btn {
				position: absolute;
				top: 5px;
				right: 8px;
				background: none;
				border: none;
				font-size: 1.2rem;
				cursor: pointer;
				color: var(--secondary-color);
			}

			@keyframes tooltipFadeIn {
				from { opacity: 0; transform: scale(0.8); }
				to { opacity: 1; transform: scale(1); }
			}

			/* 响应式设计 */
			@media (max-width: 768px) {
				.container {
					padding: 10px;
				}

				.header h1 {
					font-size: 2rem;
				}

				.selected-day {
					height: 90px;
					padding: 12px 20px;
					font-size: 1.1rem;
				}

				.selected-day .festival-info {
					font-size: 0.85rem;
				}

				.selected-day-bottom {
					height: 110px;
					padding: 15px;
				}

				.selected-day-bottom .festival-info {
					font-size: 0.9rem;
				}

				.calendar-table td {
					height: 60px;
					padding: 4px;
				}

				.day-number {
					font-size: 1rem;
				}

				.lunar-date {
					font-size: 0.9rem;
				}

				.extra-info {
					font-size: 0.7rem;
				}

				.eclipse-info {
					font-size: 0.65rem;
				}

				.controls {
					flex-direction: column;
					gap: 10px;
				}

				.controls select {
					width: 100%;
					max-width: 200px;
				}

				.today-btn {
					width: 100%;
					max-width: 200px;
					margin-top: 10px;
				}
			}

			@media (max-width: 480px) {
				.calendar-table td {
					height: 60px;
					padding: 2px;
				}

				.day-number {
					font-size: 0.9rem;
				}

				.lunar-date {
					font-size: 0.8rem;
				}

				.extra-info {
					display: none;
				}

				.eclipse-info {
					font-size: 0.6rem;
				}

				.lunar-date.festival::before {
					font-size: 0.5rem;
					top: -1px;
					right: -1px;
				}
			}

			/* 动画效果 */
			@keyframes fadeIn {
				from {
					opacity: 0;
					transform: translateY(20px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}

			.calendar-container {
				animation: fadeIn 0.6s ease-out;
			}

			/* 隐藏/显示类 */
			.narrow { display: none; }
			.wide { display: block; }

			@media (max-width: 639px) {
				.narrow { display: block; }
				.wide { display: none; }
			}

			/* 详情弹窗样式 */
			#detailMask {
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: rgba(0, 0, 0, 0.5);
				z-index: 1000;
				display: none;
				backdrop-filter: blur(5px);
			}

			#detailDialog {
				background: var(--card-bg);
				border-radius: 15px;
				padding: 20px;
				box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
				max-width: 480px;
				width: 90%;
				max-height: 90%;
				overflow-y: auto;
				display: none;
				position: fixed;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%);
				z-index: 1001;
				transition: transform 0.3s ease-out, opacity 0.3s ease-out;
				transform-origin: center;
			}

			#detailDialog.bottom-sheet {
				position: fixed;
				top: auto;
				bottom: 0;
				left: 0;
				right: 0;
				transform: translateY(100%);
				width: 100%;
				max-width: none;
				max-height: 80vh;
				border-radius: 12px 12px 0 0;
				transition: transform 0.15s ease-out;
			}

			#detailDialog.bottom-sheet.active {
				transform: translateY(0);
			}

			#detailContent {
				padding: 0;
			}

			#detailContent h3 {
				color: var(--primary-color);
				margin-bottom: 15px;
				font-size: 1.5rem;
				text-align: center;
			}

			.detail-section {
				margin-bottom: 20px;
				padding-bottom: 15px;
				border-bottom: 1px solid var(--border-color);
			}

			.detail-section:last-child {
				border-bottom: none;
				padding-bottom: 0;
			}

			.detail-section h4 {
				color: var(--primary-color);
				margin-bottom: 10px;
				font-size: 1.1rem;
			}

			.festival-section .festival-info {
				color: var(--accent-color);
				font-weight: 600;
				font-size: 1.1rem;
				margin-bottom: 5px;
			}

			.festival-section .festival-desc {
				font-size: 0.9rem;
				color: var(--text-color);
				margin-top: 3px;
			}

			.eclipse-section p {
				color: var(--secondary-color);
				font-size: 0.9rem;
				margin-top: 5px;
			}

			.date-url {
				word-break: break-all;
				font-size: 0.9rem;
				color: var(--text-color);
				background: var(--bg-color);
				padding: 10px;
				border-radius: 8px;
				border: 1px solid var(--border-color);
				white-space: pre-wrap;
				word-wrap: break-word;
			}

			.close-btn {
				position: absolute;
				top: 10px;
				right: 10px;
				background: none;
				border: none;
				font-size: 2rem;
				color: var(--secondary-color);
				cursor: pointer;
				padding: 5px;
				border-radius: 50%;
				transition: background-color 0.2s ease;
			}

			.close-btn:hover {
				background-color: rgba(139, 69, 19, 0.1);
			}

			.dialog-header {
				position: absolute;
				top: 8px;
				right: 8px;
				display: flex;
				gap: 8px;
				align-items: center;
				z-index: 1;
			}

			.dialog-header .close-btn {
				position: static;
				font-size: 1.2rem;
				color: var(--secondary-color);
				padding: 4px 8px;
				border-radius: 4px;
			}

					.dialog-header .share-btn {
			background: none;
			border: none;
			font-size: 0.9rem;
			cursor: pointer;
			color: var(--primary-color);
			padding: 6px 12px;
			border-radius: 4px;
			transition: all 0.2s ease;
			font-weight: 500;
		}

			.dialog-header .share-btn:hover {
				background-color: var(--primary-color);
				color: #fff;
			}

			.dialog-header .close-btn:hover {
				background-color: rgba(0, 0, 0, 0.1);
			}

			.dialog-footer {
				display: flex;
				justify-content: center;
				margin-top: 16px;
				padding-top: 16px;
				border-top: 1px solid var(--border-color);
			}

			.dialog-actions {
				display: flex;
				gap: 10px;
				justify-content: center;
				margin-top: 16px;
				padding-top: 16px;
				border-top: 1px solid var(--border-color);
			}

			.copy-btn, .share-btn {
				padding: 8px 16px;
				border: 1px solid var(--primary-color);
				background: transparent;
				color: var(--primary-color);
				border-radius: 6px;
				cursor: pointer;
				font-size: 0.9rem;
				transition: all 0.2s ease;
			}

			.copy-btn:hover, .share-btn:hover {
				background-color: var(--primary-color);
				color: #fff;
			}

			.copy-btn {
				padding: 8px 16px;
				border: 1px solid var(--primary-color);
				background: transparent;
				color: var(--primary-color);
				border-radius: 6px;
				cursor: pointer;
				font-size: 0.9rem;
				transition: all 0.2s ease;
			}

			.copy-btn:hover {
				background-color: var(--primary-color);
				color: #fff;
			}

			/* 弹窗响应式设计 */
			@media (max-width: 768px) {
				#detailDialog {
					max-width: 95vw;
					margin: 20px auto;
					padding: 20px;
				}

				#detailDialog.bottom-sheet {
					max-height: 85vh;
					padding: 20px;
				}

				.dialog-header {
					top: 12px;
					right: 12px;
					gap: 12px;
				}

				.share-btn,
				.close-btn {
					padding: 8px 10px;
					font-size: 1.3rem;
				}

				.detail-section {
					padding: 10px;
					margin-bottom: 12px;
				}

				.dialog-footer {
					margin-top: 20px;
					padding-top: 20px;
				}

				.copy-btn {
					width: 100%;
					padding: 12px;
				}
			}

			@media (max-width: 480px) {
				#detailDialog {
					padding: 16px;
				}

				#detailContent h3 {
					font-size: 1.1rem;
					margin-bottom: 12px;
					padding-right: 60px;
				}

				.dialog-header {
					top: 8px;
					right: 8px;
					gap: 8px;
				}

				.share-btn,
				.close-btn {
					padding: 6px 8px;
					font-size: 1.2rem;
				}

				.detail-section h4 {
					font-size: 0.9rem;
				}

				.detail-section p {
					font-size: 0.85rem;
				}

				.date-url {
					font-size: 0.75rem;
				}

				.copy-btn {
					padding: 10px;
					font-size: 0.85rem;
				}
			}
		</style>

		<script>
		const $ = id => document.getElementById(id);
		let $m, $y;
		const today = new Date();
		let selectedCell = null;
		function zangli_callback() {
			// 确保DOM已经加载完成
			if (!document.body || !$("selectedDay") || !$("selectedDayBottom")) {
				// 如果DOM还没准备好，延迟执行
				setTimeout(zangli_callback, 100);
				return;
			}
			
			const h = location.hash;
			$m = $("month");
			$y = $("year");
			let d = h ? new Date(h.substr(1)) : new Date();
			if (d < startDate) d = startDate;
			if (d > endDate) d = endDate;
			
			// 更新选中日期显示
			updateSelectedDayDisplay(d);
			
			// 清除之前的选中状态
			selectedCell = null;
			hideFestivalTooltip();
			$y.options.length = 0;
			for (let i = 1951; i < 2052; i++) {
				$y.appendChild(new Option(i));
			}
			$m.options.length = 0;
			
			for (let i = 1; i < 13; i++) {
				if (!(d.getFullYear() === 2051 && i > 2))
					$m.appendChild(new Option(i));
			}
			$y.value = d.getFullYear();
			$m.value = d.getMonth() + 1;

			const tbody = document.getElementsByTagName("tbody")[0];
			while (tbody.rows.length > 1) {
				tbody.deleteRow(tbody.rows.length - 1);
			}
			let tr, td;
			const d0 = new Date(d.getFullYear(), d.getMonth(), 1); //月初
			const d1 = new Date(d.getFullYear(), d.getMonth() + 1, 0); //月末
			tr = tbody.insertRow();
			for (let i = 0; i < d0.getDay(); i++) {
				td = tr.insertCell();
			}
			let d3;
			for (let i = d0.getDate(); i <= d1.getDate(); i++) {
				d3 = new Date(d.getFullYear(), d.getMonth(), i);
				if (d3.getDay() === 0) {
					tr = tbody.insertRow();
				}
				const z = getZangli(d3);
				const ecl = getEclipse(d3);
				const t = [];
				
				// 检查是否是今天
				const isToday = d3.getFullYear() === today.getFullYear() && 
								d3.getMonth() === today.getMonth() && 
								d3.getDate() === today.getDate();

				if (i === d0.getDate()) {
					t.push(trans(`<div class='day-number first-day'><span class='wide'>${d.getFullYear()}年${d.getMonth() + 1}月1日</span><span class='narrow'>${i}</span>`));
				} else {
					t.push(`<div class='day-number'>${i}`);
				}
				// 检查是否是节日
				const isFestival = z.extraInfo && z.extraInfo.trim() !== "" && z.extraInfo !== "&nbsp;";
				const festivalClass = isFestival ? " festival" : "";
				
				t.push(`</div><div class='lunar-date${festivalClass}'>`);
				if (z.day === "初一" || (z.day === "初二" && z.dayMiss))
					t.push(trans(`<span class='lunar-month'>${z.month === '正' && !z.monthLeap ? z.year + "年<br>" : ""}${z.month}月</span><br>${z.day}`));
				else if (z.value !== "error") t.push(trans(z.day));
				t.push(`</div><div class='extra-info wide'>`);
				t.push(z.extraInfo ? trans(z.extraInfo) : "&nbsp;");
				t.push(`</div><div class='eclipse-info wide'>`);
				t.push(ecl.value ? trans(`${ecl.value},${ecl.extraInfo.replace(/，/,",<br>")}`) : (z.extraInfo2 ? trans(z.extraInfo2) : "&nbsp;" ));
				t.push(`</div>`);
				td = tr.insertCell();
				td.innerHTML = t.join("");
				
				// 添加今天的样式
				if (isToday) {
					td.className = "today";
				}
				
				if (z.value !== "error")
					td.title = trans(`公历${d3.getFullYear()}年${d3.getMonth() + 1}月${d3.getDate()}日，藏历${z.value}`);
				if (ecl.value !== "") {
					td.title = trans(`${td.title},${ecl.value}`);
					if (/日/.test(ecl.value))
						td.className = (td.className || "") + " solareclipse";
					else
						td.className = (td.className || "") + " lunareclipse";
				}
				if (ecl.extraInfo !== "") {
					td.title = trans(`${td.title},${ecl.extraInfo}`);
				}
			}
			for (let i = d3.getDay(); i < 6; i++) {
				tr.insertCell();
			}
		}
		function updateSelectedDayDisplay(date) {
			const z = getZangli(date);
			const dateStr = trans(`公历${date.getFullYear()}年${date.getMonth() + 1}月${date.getDate()}日，藏历${z.value}`);
			
			// 检查是否有节日信息
			let festivalInfo = "";
			if (z.extraInfo && z.extraInfo.trim() !== "" && z.extraInfo !== "&nbsp;") {
				festivalInfo = z.extraInfo.replace(/<br>/g, " ");
				if (z.extraInfo2 && z.extraInfo2.trim() !== "" && z.extraInfo2 !== "&nbsp;") {
					festivalInfo += `, ${z.extraInfo2}`;
				}
			}
			
			let html = dateStr;
			let bottomHtml = dateStr;
			if (festivalInfo) {
				html += `<div class="festival-info">${trans(festivalInfo)}</div>`;
				bottomHtml += `<div class="festival-info">${trans(festivalInfo)}</div>`;
			}
			
			// 确保DOM元素存在后再设置内容
			const selectedDayElement = $("selectedDay");
			const selectedDayBottomElement = $("selectedDayBottom");
			
			if (selectedDayElement) {
				selectedDayElement.innerHTML = html;
			}
			if (selectedDayBottomElement) {
				selectedDayBottomElement.innerHTML = bottomHtml;
			}
		}

		function showDay(e) {
			if (!e) return;
			while (e && e.tagName !== "TD" && e.tagName !== "TABLE") {
				e = e.parentNode;
			}
			if (!e || e.tagName !== "TD") return;
			if (selectedCell) {
				selectedCell.classList.remove('selected');
			}
			if (e.innerHTML.trim() !== "") {
				selectedCell = e;
				e.classList.add('selected');
				if (e.title) {
					const titleParts = e.title.split(trans("，"));
					if (titleParts.length >= 2) {
						const gregorianMatch = titleParts[0].match(new RegExp(trans("公历(\\d+)年(\\d+)月(\\d+)日")));
						if (gregorianMatch) {
							const selectedDate = new Date(parseInt(gregorianMatch[1]), parseInt(gregorianMatch[2]) - 1, parseInt(gregorianMatch[3]));
							updateSelectedDayDisplay(selectedDate);
							openDetail(selectedDate, e);
						}
					} else {
						const selectedDayElement = $("selectedDay");
						if (selectedDayElement) {
							selectedDayElement.innerHTML = e.title;
						}
					}
				}
			}
		}

		function buildDetailHTML(date) {
			const z = getZangli(date);
			const ecl = getEclipse(date);
			const weekDays = [trans('日'), trans('一'), trans('二'), trans('三'), trans('四'), trans('五'), trans('六')];
			
			let html = `<h3 id="detailTitle">${date.getFullYear()}${trans('年')}${date.getMonth()+1}${trans('月')}${date.getDate()}${trans('日 周')}${weekDays[date.getDay()]}</h3>`;
			
			// 藏历信息
			html += `<div class="detail-section">`;
			html += `<h4>📖 ${trans('藏历信息')}</h4>`;
			html += `<p><strong>${trans('藏历日期：')}</strong>${z.value}</p>`;
			if (z.monthLeap) html += `<p><small>🔸 ${trans('闰月')}</small></p>`;
			if (z.dayLeap) html += `<p><small>🔸 ${trans('闰日')}</small></p>`;
			if (z.dayMiss) html += `<p><small>🔸 ${trans('缺日')}</small></p>`;
			html += `</div>`;
			
			// 节日信息
			if (z.extraInfo && z.extraInfo.trim() !== '' && z.extraInfo !== '&nbsp;') {
				html += `<div class="detail-section festival-section">`;
				html += `<h4>🎊 ${trans('节日庆典')}</h4>`;
				html += `<p class="festival-info">${z.extraInfo}</p>`;
				if (z.extraInfo2 && z.extraInfo2.trim() !== '' && z.extraInfo2 !== '&nbsp;') {
					html += `<p class="festival-desc">${z.extraInfo2}</p>`;
				}
				html += `</div>`;
			}
			
			// 日月食信息
			if (ecl.value) {
				html += `<div class="detail-section eclipse-section">`;
				html += `<h4>🌙 ${trans('天象信息')}</h4>`;
				html += `<p><strong>${ecl.value}</strong></p>`;
				if (ecl.extraInfo) html += `<p>${ecl.extraInfo}</p>`;
				if (ecl.extraInfo2) html += `<p>${ecl.extraInfo2}</p>`;
				html += `</div>`;
			}
			
			return html;
		}

		function openDetail(date, anchor) {
			if (!detailDialog) initDetailElements();
			activeDate = date;
			const isMobile = window.innerWidth <= 768;
			detailDialog.classList.toggle('bottom-sheet', isMobile);
			detailContent.innerHTML = buildDetailHTML(date);
			detailMask.style.display = 'block';
			detailDialog.style.display = 'block';
			if (isMobile) {
				requestAnimationFrame(() => detailDialog.classList.add('active'));
			}
			detailDialog.querySelector('.close-btn').focus();
			const pad = n => n.toString().padStart(2, '0');
			history.pushState({}, '', `/date/${date.getFullYear()}-${pad(date.getMonth()+1)}-${pad(date.getDate())}`);
		}

		function closeDetail() {
			if (!detailDialog) return;
			detailMask.style.display = 'none';
			if (detailDialog.classList.contains('bottom-sheet')) {
				detailDialog.classList.remove('active');
				setTimeout(() => { detailDialog.style.display = 'none'; }, 150);
			} else {
				detailDialog.style.display = 'none';
			}
			history.pushState({}, '', '/');
		}

		function shareDate() {
			if (!activeDate) return;
			const pad = n => n.toString().padStart(2, '0');
			const dateStr = `${activeDate.getFullYear()}${trans('年')}${activeDate.getMonth()+1}${trans('月')}${activeDate.getDate()}${trans('日')}`;
			const url = `${location.origin}/date/${activeDate.getFullYear()}-${pad(activeDate.getMonth()+1)}-${pad(activeDate.getDate())}`;
			
			const shareData = {
				title: `${trans('百年藏历')} - ${dateStr}`,
				text: `${trans('查看')}${dateStr}${trans('的藏历信息')}`,
				url: url
			};
			
			if (navigator.share) {
				navigator.share(shareData).catch(() => {
					// 降级到复制链接
					fallbackCopyUrl(url);
				});
			} else {
				fallbackCopyUrl(url);
			}
		}

		function fallbackCopyUrl(url) {
			if (navigator.clipboard) {
				navigator.clipboard.writeText(url).then(() => {
					showToast(trans('分享链接已复制'));
				}).catch(() => {
					legacyCopyUrl(url);
				});
			} else {
				legacyCopyUrl(url);
			}
		}

		function legacyCopyUrl(url) {
			const textArea = document.createElement('textarea');
			textArea.value = url;
			document.body.appendChild(textArea);
			textArea.select();
			document.execCommand('copy');
			document.body.removeChild(textArea);
			showToast(trans('分享链接已复制'));
		}

		function showToast(msg) {
			const t = document.createElement('div');
			t.textContent = msg;
			t.style.position = 'fixed';
			t.style.bottom = '20px';
			t.style.left = '50%';
			t.style.transform = 'translateX(-50%)';
			t.style.background = 'rgba(0,0,0,0.7)';
			t.style.color = '#fff';
			t.style.padding = '8px 12px';
			t.style.borderRadius = '4px';
			t.style.zIndex = '1001';
			document.body.appendChild(t);
			setTimeout(() => t.remove(), 2000);
		}

		function copyDateInfo() {
			if (!activeDate) return;
			const z = getZangli(activeDate);
			const ecl = getEclipse(activeDate);
			const weekDays = [trans('日'), trans('一'), trans('二'), trans('三'), trans('四'), trans('五'), trans('六')];
			
			let copyText = `${activeDate.getFullYear()}${trans('年')}${activeDate.getMonth()+1}${trans('月')}${activeDate.getDate()}${trans('日 周')}${weekDays[activeDate.getDay()]}\n`;
			copyText += `${trans('藏历：')}${z.value}\n`;
			
			if (z.extraInfo && z.extraInfo.trim() !== '' && z.extraInfo !== '&nbsp;') {
				copyText += `${trans('节日：')}${z.extraInfo.replace(/<br>/g, ' ')}\n`;
				if (z.extraInfo2 && z.extraInfo2.trim() !== '' && z.extraInfo2 !== '&nbsp;') {
					copyText += `${z.extraInfo2}\n`;
				}
			}
			
			if (ecl.value) {
				copyText += `${trans('天象：')}${ecl.value}\n`;
				if (ecl.extraInfo) copyText += `${ecl.extraInfo.replace(/<br>/g, ' ')}\n`;
			}
			
			if (navigator.clipboard) {
				navigator.clipboard.writeText(copyText).then(() => {
					showToast(trans('日期信息已复制'));
				});
			} else {
				// 降级处理
				const textArea = document.createElement('textarea');
				textArea.value = copyText;
				document.body.appendChild(textArea);
				textArea.select();
				document.execCommand('copy');
				document.body.removeChild(textArea);
				showToast(trans('日期信息已复制'));
			}
		}

		let detailMask, detailDialog, detailContent, activeDate;

		function initDetailElements() {
			detailMask = document.getElementById('detailMask');
			detailDialog = document.getElementById('detailDialog');
			detailContent = document.getElementById('detailContent');
		}

		const pad = n => n.toString().padStart(2, '0');
		</script>
		<script src="https://cdn.jsdelivr.net/npm/opencc-js@1.0.5/dist/umd/full.min.js"></script>
		<script src="../js/i18n.js"></script>
		<script src="../zangli.js" charset="UTF-8"></script>
		<script src="../eclipse.js" charset="UTF-8"></script>
		<script>
		window.onhashchange = zangli_callback;
		</script>
		<script>
		window.addEventListener('load', () => {
			zangli_callback();
		});

		document.addEventListener('keydown', e => {
			if (e.key === 'Escape') {
				closeDetail();
			}
			if (detailDialog && detailDialog.style.display === 'block') {
				if (e.key === 'c' && (e.ctrlKey || e.metaKey)) {
					e.preventDefault();
					copyDateInfo();
				}
				if (e.key === 's' && (e.ctrlKey || e.metaKey)) {
					e.preventDefault();
					shareDate();
				}
			}
		});
		</script>
	</head>
	<body onkeyup="changeDate(event.keyCode)">
		<div class="container">
                        <div class="header">
                                <h1>百年藏曆</h1>
                                <div id="countdown-placeholder-zh"></div>
                                <div id="countdown-placeholder-en"></div>
                                <!-- <div class="lang-switch"><a href="../index.html">简体中文 / 繁體中文</a></div> -->
                                <div class="selected-day" id="selectedDay"></div>
                        </div>

			<div class="controls">
				<button onclick="changeYear(-1)" class="nav-btn prev-year"><span>◀ 上一年</span></button>
				<button onclick="changeMonth(-1)" class="nav-btn prev-month"><span>◀ 上一月</span></button>
				<button onclick="goToToday()" class="nav-btn today-btn">📅 今天</button>
				<button onclick="changeMonth(1)" class="nav-btn next-month"><span>下一月 ▶</span></button>
				<button onclick="changeYear(1)" class="nav-btn next-year"><span>下一年 ▶</span></button>
				
				<!-- 隐藏的年份和月份选择器，用于维护原有逻辑 -->
				<select id="year" onchange="changeDate('year')" style="display: none;"></select>
				<select id="month" onchange="changeDate('month')" style="display: none;"></select>
			</div>

			<div class="calendar-container">
				<table class="calendar-table">
					<tbody onmousedown="showDay(event.target || event.srcElement)" onclick="showDay(event.target || event.srcElement)">
						<tr>
							<th>週日</th>
							<th>週一</th>
							<th>週二</th>
							<th>週三</th>
							<th>週四</th>
							<th>週五</th>
							<th>週六</th>
						</tr>
					</tbody>
				</table>
			</div>

			<div class="selected-day-bottom" id="selectedDayBottom"></div>

			<div class="info-section">
				<h3>📚 資料來源</h3>
				<p>• 藏曆資料來源於《藏曆、公曆、農曆對照百年曆書（1951-2050）》</p>
				<p>• 日月食資料來自NASA，並從UTC時間轉換到北京時間計算日期</p>
				<p>• 由於地球上不同位置看到的初虧復圓時間會不同，時間可能存在誤差</p>
			</div>

			<div class="info-section">
				<h3>🔗 開源資訊</h3>
				<p>本頁面和資料開源於 <a href="https://github.com/stonelf/zangli" target="_blank" style="color: var(--primary-color); text-decoration: none;">GitHub</a>，歡迎下載使用。</p>
			</div>

			<noscript>
				<div class="info-section">
					<h3>靜態版本</h3>
					<p>不支援JavaScript的瀏覽器可以直接存取本月曆的HTML版本：
						<a href="../calendar/1952.html">1952年藏曆月曆</a> 
						<a href="../calendar/1953.html">1953年藏曆月曆</a> 
						<!-- 其他年份鏈接省略以保持簡潔 -->
					</p>
				</div>
			</noscript>
		</div>

		<!-- 详情弹窗 -->
		<div id="detailMask" onclick="closeDetail()"></div>
		<div id="detailDialog" aria-modal="true" role="dialog" tabindex="-1" aria-labelledby="detailTitle" aria-describedby="detailContent" onclick="event.stopPropagation()">
			<div class="dialog-header">
				<button class="share-btn" onclick="shareDate()" aria-label="分享日期">分享</button>
				<button class="close-btn" onclick="closeDetail()" aria-label="關閉彈窗">×</button>
			</div>
			<div id="detailContent"></div>
			<div class="dialog-footer">
				<button class="copy-btn" onclick="copyDateInfo()" aria-label="復製日期信息 (Ctrl+C)">📋 復製信息</button>
			</div>
		</div>
	</body>
</html> 